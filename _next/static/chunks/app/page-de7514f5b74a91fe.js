(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{247:(e,t,s)=>{Promise.resolve().then(s.bind(s,7102))},7102:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>z});var r=s(5155),a=s(2115),l=s(7273),n=s(4521),i=s(6041),d=s(2821),c=s(5889);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,c.QP)((0,d.$)(t))}function m(e){return e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}function x(e){return e.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}function u(e){if(e<60)return"".concat(e,"分钟");let t=Math.floor(e/60),s=e%60;return 0===s?"".concat(t,"小时"):"".concat(t,"小时").concat(s,"分钟")}function g(e){let{task:t,assignedUser:s,onEdit:a,onDelete:l}=e,{attributes:d,listeners:c,setNodeRef:x,transform:g,isDragging:h}=(0,n.PM)({id:t.id}),b=g?{transform:"translate3d(".concat(g.x,"px, ").concat(g.y,"px, 0)")}:void 0;return(0,r.jsxs)("div",{ref:x,style:b,...c,...d,className:o("p-3 sm:p-4 rounded-lg border-2 cursor-grab active:cursor-grabbing transition-all duration-200 task-card draggable-item","touch-action-none select-none",(e=>{switch(e){case i.e.TODO:return"border-gray-200 bg-white";case i.e.IN_PROGRESS:return"border-blue-200 bg-blue-50";case i.e.COMPLETED:return"border-green-200 bg-green-50";default:return"border-gray-200 bg-white"}})(t.status),h&&"opacity-50 scale-105 shadow-lg",t.isUrgent&&"ring-2 ring-red-400"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 min-w-0 flex-1",children:[(0,r.jsx)("span",{className:"text-base sm:text-lg flex-shrink-0",children:(e=>{switch(e){case i.e.TODO:return"⏳";case i.e.IN_PROGRESS:return"\uD83D\uDD04";case i.e.COMPLETED:return"✅";default:return"⏳"}})(t.status)}),(0,r.jsx)("h3",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:t.title})]}),t.isUrgent&&(0,r.jsx)("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded-full flex-shrink-0 ml-2",children:"加急"})]}),t.description&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:t.description}),(0,r.jsxs)("div",{className:"space-y-2",children:[s&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"分配给:"}),(0,r.jsx)("span",{className:"text-xs font-medium text-gray-700",children:s.name})]}),t.estimatedMinutes&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"预估:"}),(0,r.jsx)("span",{className:"text-xs text-gray-700",children:u(t.estimatedMinutes)})]}),t.status===i.e.COMPLETED&&t.actualMinutes&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"实际:"}),(0,r.jsx)("span",{className:"text-xs text-green-700 font-medium",children:u(t.actualMinutes)})]}),t.startedAt&&t.status===i.e.IN_PROGRESS&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"开始:"}),(0,r.jsx)("span",{className:"text-xs text-blue-700",children:m(new Date(t.startedAt))})]}),t.completedAt&&t.status===i.e.COMPLETED&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"完成:"}),(0,r.jsx)("span",{className:"text-xs text-green-700",children:m(new Date(t.completedAt))})]}),t.isUrgent&&t.urgentPrice&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"外包价:"}),(0,r.jsxs)("span",{className:"text-xs text-red-700 font-medium",children:["\xa5",t.urgentPrice]})]})]}),(0,r.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,r.jsx)("span",{className:"px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:t.category}),(0,r.jsx)("span",{className:"text-xs text-gray-400",children:function(e){let t=Math.floor((new Date().getTime()-e.getTime())/6e4);if(t<1)return"刚刚";if(t<60)return"".concat(t,"分钟前");if(t<1440){let e=Math.floor(t/60);return"".concat(e,"小时前")}{let e=Math.floor(t/1440);return"".concat(e,"天前")}}(new Date(t.createdAt))})]}),!h&&(a||l)&&(0,r.jsxs)("div",{className:"mt-3 flex gap-3 sm:gap-2",children:[a&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),a(t)},className:"text-xs sm:text-sm text-blue-600 hover:text-blue-800 btn-touch min-h-[32px] px-2",children:"编辑"}),l&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),l(t.id)},className:"text-xs sm:text-sm text-red-600 hover:text-red-800 btn-touch min-h-[32px] px-2",children:"删除"})]})]})}function h(e){let{id:t,title:s,status:a,tasks:l,users:d,onEditTask:c,onDeleteTask:m}=e,{isOver:x,setNodeRef:u}=(0,n.zM)({id:t}),h=e=>{switch(e){case i.e.TODO:return"bg-gray-50 border-gray-200";case i.e.IN_PROGRESS:return"bg-blue-50 border-blue-200";case i.e.COMPLETED:return"bg-green-50 border-green-200";default:return"bg-gray-50 border-gray-200"}},b=l.filter(e=>e.status===a);return(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:o("bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden","sm:bg-transparent sm:rounded-none sm:shadow-none sm:border-none sm:overflow-visible"),children:[(0,r.jsx)("div",{className:o("p-3 sm:p-4","sm:rounded-t-lg sm:border-2 sm:border-b-0","sm:"+h(a)),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,r.jsx)("span",{className:"text-base sm:text-lg",children:(e=>{switch(e){case i.e.TODO:return"\uD83D\uDCCB";case i.e.IN_PROGRESS:return"\uD83D\uDD04";case i.e.COMPLETED:return"✅";default:return"\uD83D\uDCCB"}})(a)}),(0,r.jsx)("h2",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:s})]}),(0,r.jsx)("span",{className:"px-2 py-1 text-xs bg-white rounded-full text-gray-600 font-medium",children:b.length})]})}),(0,r.jsxs)("div",{ref:u,className:o("min-h-[200px] sm:min-h-[400px] p-3 sm:p-4 transition-colors task-board-column","bg-gray-50","sm:border-2 sm:border-t-0 sm:rounded-b-lg sm:bg-transparent","sm:"+h(a),x&&"ring-2 ring-blue-400 ring-opacity-50"),children:[(0,r.jsx)("div",{className:"space-y-2 sm:space-y-3",children:0===b.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-24 sm:h-32 text-gray-400",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-xl sm:text-2xl mb-1 sm:mb-2",children:[a===i.e.TODO&&"\uD83C\uDFAF",a===i.e.IN_PROGRESS&&"\uD83D\uDCAA",a===i.e.COMPLETED&&"\uD83C\uDF89"]}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm",children:[a===i.e.TODO&&"暂无待办任务",a===i.e.IN_PROGRESS&&"暂无进行中任务",a===i.e.COMPLETED&&"暂无已完成任务"]})]})}):b.map(e=>{let t=d.find(t=>t.id===e.assignedTo);return(0,r.jsx)(g,{task:e,assignedUser:t,onEdit:c,onDelete:m},e.id)})}),x&&(0,r.jsx)("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 border-2 border-dashed border-blue-400 rounded-lg bg-blue-50",children:(0,r.jsxs)("p",{className:"text-center text-blue-600 text-xs sm:text-sm",children:['松开以移动任务到 "',s,'"']})})]})]})})}var b=s(6274);function p(e){let{tasks:t,family:s}=e,{actions:d}=(0,l.n)(),[c,o]=(0,a.useState)(null),m=(0,n.FR)((0,n.MS)(n.AN,{activationConstraint:{distance:8,delay:100,tolerance:5}})),x=e=>{console.log("Edit task:",e)},u=e=>{confirm("确定要删除这个任务吗？")&&d.deleteTask(e)},p=[{id:i.e.TODO,title:"待做",status:i.e.TODO},{id:i.e.IN_PROGRESS,title:"进行中",status:i.e.IN_PROGRESS},{id:i.e.COMPLETED,title:"已完成",status:i.e.COMPLETED}];return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsxs)("div",{className:"mb-4 sm:mb-6 grid grid-cols-3 gap-2 sm:gap-4",children:[(0,r.jsx)("div",{className:"bg-white p-3 sm:p-4 rounded-lg border shadow-sm",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-gray-900",children:t.filter(e=>e.status===i.e.TODO).length}),(0,r.jsx)("div",{className:"text-xs sm:text-sm text-gray-500",children:"待办任务"})]})}),(0,r.jsx)("div",{className:"bg-white p-3 sm:p-4 rounded-lg border shadow-sm",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-blue-600",children:t.filter(e=>e.status===i.e.IN_PROGRESS).length}),(0,r.jsx)("div",{className:"text-xs sm:text-sm text-gray-500",children:"进行中"})]})}),(0,r.jsx)("div",{className:"bg-white p-3 sm:p-4 rounded-lg border shadow-sm",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-green-600",children:t.filter(e=>e.status===i.e.COMPLETED).length}),(0,r.jsx)("div",{className:"text-xs sm:text-sm text-gray-500",children:"已完成"})]})})]}),(0,r.jsxs)(n.Mp,{sensors:m,onDragStart:e=>{let{active:s}=e;o(t.find(e=>e.id===s.id)||null)},onDragEnd:e=>{let{active:r,over:a}=e;if(o(null),!a)return;let l=r.id,n=a.id,c=t.find(e=>e.id===l);if(c&&c.status!==n){if((0,b.I1)(s.workEndTime)&&c.status===i.e.TODO&&n===i.e.IN_PROGRESS)return void alert("收工时间已到！如需继续工作，请使用加急功能。");d.moveTask(l,n)}},children:[(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:p.map(e=>(0,r.jsx)(h,{id:e.id,title:e.title,status:e.status,tasks:t,users:s.members,onEditTask:x,onDeleteTask:u},e.id))}),(0,r.jsx)(n.Hd,{children:c?(0,r.jsx)("div",{className:"rotate-3 scale-105",children:(0,r.jsx)(g,{task:c,assignedUser:s.members.find(e=>e.id===c.assignedTo)})}):null})]}),(0,b.I1)(s.workEndTime)&&(0,r.jsx)("div",{className:"mt-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-orange-500",children:"⏰"}),(0,r.jsxs)("p",{className:"text-orange-700 text-sm",children:["收工时间已到（",s.workEndTime,"）！新增任务需要议价确认。"]})]})})]})}function j(e){let{variant:t="primary",size:s="md",className:a,children:l,...n}=e;return(0,r.jsx)("button",{className:o("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-blue-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[t],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[s],a),...n,children:l})}function f(e){let{family:t,onShowStats:s,onShowTaskCreator:a,onShowTaskGrab:l}=e,n=m(new Date);return(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:t.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["当前时间 ",n]})]})}),(0,r.jsxs)("div",{className:"hidden md:flex items-center gap-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[0,"/",0]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"今日任务"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["\xa5",t.monthlyFund]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"月度基金"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 sm:gap-3",children:[(0,r.jsxs)(j,{variant:"outline",size:"sm",className:"btn-touch min-w-[44px] min-h-[44px] px-2 sm:px-3",title:"收工时间：".concat(t.workEndTime),children:[(0,r.jsx)("span",{className:"text-xl sm:text-lg",children:"\uD83D\uDD14"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-1 text-sm",children:"收工铃"})]}),l&&(0,r.jsxs)(j,{variant:"outline",size:"sm",onClick:l,className:"btn-touch min-w-[44px] min-h-[44px] px-2 sm:px-3",children:[(0,r.jsx)("span",{className:"text-xl sm:text-lg",children:"\uD83D\uDCAA"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-1 text-sm",children:"抢单"})]}),(0,r.jsxs)(j,{variant:"outline",size:"sm",onClick:s,className:"btn-touch min-w-[44px] min-h-[44px] px-2 sm:px-3",children:[(0,r.jsx)("span",{className:"text-xl sm:text-lg",children:"\uD83D\uDCCA"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-1 text-sm",children:"战绩"})]}),(0,r.jsxs)(j,{variant:"primary",size:"sm",onClick:a,className:"btn-touch min-w-[44px] min-h-[44px] px-2 sm:px-3",children:[(0,r.jsx)("span",{className:"text-xl sm:text-lg",children:"➕"}),(0,r.jsx)("span",{className:"hidden sm:inline ml-1 text-sm",children:"添加任务"})]})]})]}),(0,r.jsx)("div",{className:"mt-3 sm:mt-4",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-3 sm:p-4 border border-blue-100",children:(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-lg sm:text-xl font-bold text-blue-600",children:[0,"/",0]}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"今日任务"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:["\xa5",t.monthlyFund]}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"月度基金"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lg sm:text-xl font-bold text-orange-600",children:t.workEndTime}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"收工时间"})]})]})})}),(0,r.jsxs)("div",{className:"mt-3 sm:mt-4 flex items-center gap-2 sm:gap-4",children:[(0,r.jsx)("span",{className:"text-xs sm:text-sm text-gray-500 flex-shrink-0",children:"成员："}),(0,r.jsx)("div",{className:"flex gap-1 sm:gap-2 overflow-x-auto scrollbar-hide",children:t.members.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 bg-gray-100 rounded-full flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium",children:e.name.charAt(0)}),(0,r.jsx)("span",{className:"text-xs sm:text-sm text-gray-700 whitespace-nowrap",children:e.name}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[e.totalCompletedTasks,"项"]})]},e.id))})]})]})})}function v(e){let{workEndTime:t,onClose:s,onContinue:l}=e,[n,i]=(0,a.useState)(new Date),[d,c]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=setInterval(()=>{i(new Date)},1e3),t=setTimeout(()=>{c(!1)},2e3);return()=>{clearInterval(e),clearTimeout(t)}},[]),(0,a.useEffect)(()=>{try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(600,e.currentTime+.1),t.frequency.setValueAtTime(800,e.currentTime+.2),s.gain.setValueAtTime(.3,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){console.log("无法播放铃声:",e)}},[]),(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-50 to-yellow-50 opacity-50"}),(0,r.jsxs)("div",{className:"relative text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4 transition-transform duration-300 ".concat(d?"animate-bounce":""),children:"\uD83D\uDD14"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Time is up!"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("p",{className:"text-gray-600 mb-2",children:["收工时间到了！（",t,"）"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["当前时间：",m(n)]})]}),(0,r.jsxs)("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[(0,r.jsx)("h3",{className:"font-medium text-orange-800 mb-2",children:"收工规则："}),(0,r.jsxs)("ul",{className:"text-sm text-orange-700 space-y-1",children:[(0,r.jsx)("li",{children:"• 新增任务默认延期到明天"}),(0,r.jsx)("li",{children:"• 继续工作需要议价确认"}),(0,r.jsx)("li",{children:"• 议价金额将加入月度基金"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)(j,{variant:"outline",onClick:s,className:"flex-1",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDE34"}),"直接收工"]}),(0,r.jsxs)(j,{variant:"primary",onClick:l,className:"flex-1",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCAA"}),"仍要加急"]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-4",children:"\uD83D\uDCA1 适当休息有助于提高工作效率"})]})]})})}let N=[{id:"template-1",title:"扫地拖地",description:"清扫客厅、卧室、厨房地面并拖地",estimatedMinutes:25,category:"清洁",icon:"\uD83E\uDDF9"},{id:"template-2",title:"洗碗刷锅",description:"清洗餐具、锅具并整理厨房台面",estimatedMinutes:15,category:"厨房",icon:"\uD83C\uDF7D️"},{id:"template-3",title:"丢垃圾",description:"清理各房间垃圾桶并倒垃圾",estimatedMinutes:10,category:"清洁",icon:"\uD83D\uDDD1️"},{id:"template-4",title:"叠衣服",description:"整理晾干的衣物并放入衣柜",estimatedMinutes:20,category:"整理",icon:"\uD83D\uDC55"},{id:"template-5",title:"洗衣服",description:"分类脏衣物并启动洗衣机",estimatedMinutes:10,category:"洗涤",icon:"\uD83D\uDC54"},{id:"template-6",title:"晾衣服",description:"将洗好的衣物晾晒或烘干",estimatedMinutes:15,category:"洗涤",icon:"\uD83E\uDDFA"},{id:"template-7",title:"整理床铺",description:"整理卧室床铺和枕头",estimatedMinutes:5,category:"整理",icon:"\uD83D\uDECF️"},{id:"template-8",title:"擦桌子",description:"清洁餐桌、茶几、书桌表面",estimatedMinutes:10,category:"清洁",icon:"\uD83E\uDE91"},{id:"template-9",title:"买菜购物",description:"采购日常生活用品和食材",estimatedMinutes:45,category:"采购",icon:"\uD83D\uDED2"},{id:"template-10",title:"做饭",description:"准备和烹饪一餐",estimatedMinutes:40,category:"厨房",icon:"\uD83C\uDF73"},{id:"template-11",title:"清洁卫生间",description:"清洁马桶、洗手台、浴室",estimatedMinutes:20,category:"清洁",icon:"\uD83D\uDEBF"},{id:"template-12",title:"整理客厅",description:"收拾客厅物品，整理沙发和茶几",estimatedMinutes:15,category:"整理",icon:"\uD83D\uDECB️"}];function y(e){let{family:t,onClose:s}=e,{actions:n}=(0,l.n)(),[d,c]=(0,a.useState)("templates"),[o,m]=(0,a.useState)([]),[x,u]=(0,a.useState)({title:"",description:"",estimatedMinutes:15,category:"其他"}),[g,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(0),v=(0,b.I1)(t.workEndTime),y=[...new Set(N.map(e=>e.category))];return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"创建新任务"}),(0,r.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("span",{className:"text-2xl",children:"\xd7"})})]}),v&&(0,r.jsx)("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-orange-700 text-sm",children:"⏰ 收工时间已到！新增任务需要设置为加急并议价。"})})]}),(0,r.jsx)("div",{className:"border-b",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("button",{onClick:()=>c("templates"),className:"px-6 py-3 text-sm font-medium border-b-2 ".concat("templates"===d?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"预设模板"}),(0,r.jsx)("button",{onClick:()=>c("custom"),className:"px-6 py-3 text-sm font-medium border-b-2 ".concat("custom"===d?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"自定义任务"})]})}),(0,r.jsxs)("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:["templates"===d?(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"选择预设任务模板（可多选）："}),y.map(e=>(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:e}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:N.filter(t=>t.category===e).map(e=>(0,r.jsx)("div",{onClick:()=>{var t;return t=e.id,void m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"p-4 border-2 rounded-lg cursor-pointer transition-all ".concat(o.includes(e.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("span",{className:"text-2xl",children:e.icon}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["预估 ",e.estimatedMinutes," 分钟"]})]}),o.includes(e.id)&&(0,r.jsx)("span",{className:"text-blue-500",children:"✓"})]})},e.id))})]},e))]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务标题 *"}),(0,r.jsx)("input",{type:"text",value:x.title,onChange:e=>u(t=>({...t,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"输入任务标题"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务描述"}),(0,r.jsx)("textarea",{value:x.description,onChange:e=>u(t=>({...t,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"输入任务描述（可选）"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"预估时间（分钟）"}),(0,r.jsx)("input",{type:"number",value:x.estimatedMinutes,onChange:e=>u(t=>({...t,estimatedMinutes:parseInt(e.target.value)||15})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"1"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分类"}),(0,r.jsxs)("select",{value:x.category,onChange:e=>u(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[y.map(e=>(0,r.jsx)("option",{value:e,children:e},e)),(0,r.jsx)("option",{value:"其他",children:"其他"})]})]})]})]}),v&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"urgent",checked:g,onChange:e=>h(e.target.checked),className:"rounded"}),(0,r.jsx)("label",{htmlFor:"urgent",className:"text-sm font-medium text-orange-700",children:"设为加急任务"})]}),g&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-orange-700 mb-2",children:"外包价（元）"}),(0,r.jsx)("input",{type:"number",value:p,onChange:e=>f(parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"输入外包价格",min:"0",step:"0.5"}),(0,r.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"对方同意后，此金额将加入月度基金"})]})]})]}),(0,r.jsx)("div",{className:"p-6 border-t bg-gray-50",children:(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)(j,{variant:"outline",onClick:s,children:"取消"}),(0,r.jsx)(j,{variant:"primary",onClick:"templates"===d?()=>{o.forEach(e=>{let s=N.find(t=>t.id===e);if(s){let e={title:s.title,description:s.description,status:i.e.TODO,estimatedMinutes:s.estimatedMinutes,category:s.category,isUrgent:!!v&&g,urgentPrice:v&&g?p:void 0};v&&g?n.addUrgentRequest({taskId:"",requestedBy:t.members[0].id,estimatedMinutes:s.estimatedMinutes,price:p,message:"加急任务：".concat(s.title),status:"pending"}):n.assignTaskAutomatically(e)}}),s()}:()=>{if(!x.title.trim())return void alert("请输入任务标题");let e={title:x.title,description:x.description,status:i.e.TODO,estimatedMinutes:x.estimatedMinutes,category:x.category,isUrgent:!!v&&g,urgentPrice:v&&g?p:void 0};v&&g?n.addUrgentRequest({taskId:"",requestedBy:t.members[0].id,estimatedMinutes:x.estimatedMinutes,price:p,message:"加急任务：".concat(x.title),status:"pending"}):n.assignTaskAutomatically(e),s()},disabled:"templates"===d?0===o.length:!x.title.trim(),children:"templates"===d?"创建 ".concat(o.length," 个任务"):"创建任务"})]})})]})})}function w(e){let{family:t,tasks:s,dailyStats:l,onShare:n}=e,d=(0,a.useRef)(null),c=new Date().toISOString().split("T")[0],o=s.filter(e=>e.status===i.e.COMPLETED&&e.completedAt&&new Date(e.completedAt).toISOString().split("T")[0]===c),m=t.members.map(e=>{let t=(0,b.qL)(e.id,s);return{member:e,stats:t}}),g=m.reduce((e,t)=>e+t.stats.minutesWorked,0),h=m.reduce((e,t)=>e+t.stats.tasksCompleted,0),p=async()=>{if(d.current)try{let e="\uD83C\uDFE0 ".concat(t.name," 今日战绩\n\uD83D\uDCC5 ").concat(x(new Date),"\n⏱️ 总时长：").concat(u(g),"\n✅ 完成任务：").concat(h,"项\n\n").concat(m.map(e=>"".concat(e.member.name,"：").concat(e.stats.tasksCompleted,"项 ").concat(u(e.stats.minutesWorked))).join("\n"),"\n\n#家庭助手 #家务分工");await navigator.clipboard.writeText(e),alert("战绩已复制到剪贴板！")}catch(e){console.error("分享失败:",e),alert("分享功能暂不可用")}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,r.jsxs)("div",{ref:d,className:"relative bg-gradient-to-b from-sky-50 to-green-50 p-6 border-2 border-green-200",children:[(0,r.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-2 left-4 w-16 h-8 bg-white rounded-full opacity-60"}),(0,r.jsx)("div",{className:"absolute top-4 left-8 w-12 h-6 bg-white rounded-full opacity-40"}),(0,r.jsx)("div",{className:"absolute top-1 right-8 w-20 h-10 bg-white rounded-full opacity-50"}),(0,r.jsx)("div",{className:"absolute top-6 right-12 w-14 h-7 bg-white rounded-full opacity-30"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-green-200 to-transparent"}),(0,r.jsx)("div",{className:"absolute bottom-2 left-4 w-2 h-4 bg-green-300 rounded-t-full"}),(0,r.jsx)("div",{className:"absolute bottom-1 left-8 w-1 h-3 bg-green-400 rounded-t-full"}),(0,r.jsx)("div",{className:"absolute bottom-3 right-6 w-2 h-5 bg-green-300 rounded-t-full"}),(0,r.jsx)("div",{className:"absolute bottom-1 right-12 w-1 h-2 bg-green-400 rounded-t-full"})]}),(0,r.jsx)("div",{className:"relative text-center mb-8",children:(0,r.jsxs)("div",{className:"inline-block bg-white rounded-full px-6 py-3 shadow-md border-2 border-green-300",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-green-800 mb-1",children:"\uD83C\uDF31 今日家务小记 \uD83C\uDF31"}),(0,r.jsx)("p",{className:"text-green-600 text-sm",children:x(new Date)})]})}),(0,r.jsx)("div",{className:"relative bg-white rounded-2xl p-6 mb-8 shadow-lg border-2 border-green-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6 text-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"bg-blue-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center border-2 border-blue-200",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"text-xl font-bold text-blue-700",children:u(g)})})}),(0,r.jsx)("div",{className:"mt-2 text-sm text-green-700 font-medium",children:"⏰ 总时长"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"bg-orange-50 rounded-full w-20 h-20 mx-auto flex items-center justify-center border-2 border-orange-200",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"text-xl font-bold text-orange-700",children:h})})}),(0,r.jsx)("div",{className:"mt-2 text-sm text-green-700 font-medium",children:"✨ 完成任务"})]})]})}),(0,r.jsx)("div",{className:"space-y-4",children:m.map((e,t)=>{let s=g>0?e.stats.minutesWorked/g*100:0,a=[{bg:"bg-pink-50",border:"border-pink-200",text:"text-pink-700",avatar:"bg-pink-100"},{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-700",avatar:"bg-blue-100"},{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-700",avatar:"bg-yellow-100"},{bg:"bg-purple-50",border:"border-purple-200",text:"text-purple-700",avatar:"bg-purple-100"}],l=a[t%a.length];return(0,r.jsxs)("div",{className:"relative ".concat(l.bg," rounded-2xl p-5 border-2 ").concat(l.border," shadow-md"),children:[(0,r.jsx)("div",{className:"absolute top-2 right-3 text-xs opacity-60",children:"\uD83C\uDF38"}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 ".concat(l.avatar," rounded-full flex items-center justify-center text-lg font-bold ").concat(l.text," border-2 ").concat(l.border," shadow-sm"),children:e.member.name.charAt(0)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-bold text-lg ".concat(l.text),children:e.member.name}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"今日小助手"})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"font-bold text-lg ".concat(l.text),children:[e.stats.tasksCompleted,"项"]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:u(e.stats.minutesWorked)})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-full bg-white rounded-full h-3 border border-gray-200 shadow-inner",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-300 to-green-400 rounded-full h-full transition-all duration-1000 ease-out shadow-sm",style:{width:"".concat(s,"%")}})}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"努力值"}),(0,r.jsxs)("div",{className:"text-xs font-medium ".concat(l.text),children:[s.toFixed(1),"%"]})]})]})]},e.member.id)})}),o.length>0&&(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-5 border-2 border-green-200 shadow-md",children:[(0,r.jsx)("h3",{className:"font-bold text-green-800 mb-4 text-center",children:"\uD83D\uDCDD 今日完成清单"}),(0,r.jsxs)("div",{className:"space-y-3",children:[o.slice(0,5).map((e,s)=>{let a=t.members.find(t=>t.id===e.assignedTo),l=["\uD83C\uDF1F","✨","\uD83C\uDFAF","\uD83D\uDCAB","⭐"];return(0,r.jsx)("div",{className:"bg-green-50 rounded-xl p-3 border border-green-200 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-lg",children:l[s%l.length]}),(0,r.jsx)("span",{className:"font-medium text-green-800",children:e.title})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-sm text-green-600 font-medium",children:null==a?void 0:a.name}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.actualMinutes?u(e.actualMinutes):""})]})]})},e.id)}),o.length>5&&(0,r.jsxs)("div",{className:"text-center text-green-600 text-sm bg-green-50 rounded-lg p-2 border border-green-200",children:["还有 ",o.length-5," 项任务完成了呢~ \uD83C\uDF38"]})]})]})}),(0,r.jsx)("div",{className:"text-center mt-8",children:(0,r.jsx)("div",{className:"inline-block bg-white rounded-full px-4 py-2 border-2 border-green-300 shadow-sm",children:(0,r.jsx)("div",{className:"text-green-700 text-sm font-medium",children:"\uD83C\uDFE0 家庭助手 • 让家务可见可停机可议价"})})})]}),(0,r.jsxs)("div",{className:"p-6 bg-gradient-to-r from-green-50 to-blue-50 border-t-2 border-green-200",children:[(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)(j,{variant:"outline",onClick:p,className:"flex-1 bg-white border-2 border-green-300 text-green-700 hover:bg-green-50 rounded-xl shadow-md",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCE4"}),"分享战绩"]}),n&&(0,r.jsxs)(j,{variant:"primary",onClick:n,className:"flex-1 bg-green-400 hover:bg-green-500 text-white rounded-xl shadow-md border-2 border-green-500",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCCA"}),"查看详情"]})]}),(0,r.jsx)("div",{className:"text-center mt-4",children:(0,r.jsx)("div",{className:"inline-block bg-white rounded-full px-6 py-3 border-2 border-green-300 shadow-sm",children:g>0?(0,r.jsxs)("p",{className:"text-sm text-green-700 font-medium",children:["� 今天辛苦了！",g>=60?"超棒的":"不错的","表现！继续加油哦~ \uD83C\uDF38"]}):(0,r.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"\uD83C\uDF31 今天还没有完成任务，一起加油吧！每一步都是成长~ ✨"})})})]})]})}var D=s(1607),k=s(877);function C(e){let{family:t,dailyStats:s}=e,l=(0,a.useRef)(null),n=(0,b.kR)(t.members,s),i={labels:["周日","周一","周二","周三","周四","周五","周六"],datasets:t.members.map((e,t)=>{let s=[{bg:"rgba(59, 130, 246, 0.8)",border:"rgb(59, 130, 246)"},{bg:"rgba(16, 185, 129, 0.8)",border:"rgb(16, 185, 129)"},{bg:"rgba(245, 158, 11, 0.8)",border:"rgb(245, 158, 11)"},{bg:"rgba(239, 68, 68, 0.8)",border:"rgb(239, 68, 68)"}],r=s[t%s.length],a=n.userStats[e.id],l=Array(7).fill(0);return a&&a.dailyBreakdown.forEach(e=>{l[new Date(e.date).getDay()]=e.minutesWorked}),{label:e.name,data:l,backgroundColor:r.bg,borderColor:r.border,borderWidth:1}})};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"本周统计"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[n.weekStart," 至 ",n.weekEnd]})]}),(0,r.jsx)("button",{onClick:()=>{if(l.current){let e=l.current.toBase64Image(),t=document.createElement("a");t.download="家庭助手-周统计-".concat(new Date().toISOString().split("T")[0],".png"),t.href=e,t.click()}},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"\uD83D\uDCE5 导出图片"})]}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(k.yP,{ref:l,data:i,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"本周工作时长对比（分钟）",font:{size:16,weight:"bold"}},tooltip:{callbacks:{label:function(e){let t=e.parsed.y;return"".concat(e.dataset.label,": ").concat(u(t))}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return u(e)}},title:{display:!0,text:"工作时长"}},x:{title:{display:!0,text:"星期"}}}}})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.members.map(e=>{let t=n.userStats[e.id],s=(null==t?void 0:t.minutesWorked)||0,a=(null==t?void 0:t.tasksCompleted)||0,l=s/7;return(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:e.name.charAt(0)}),(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e.name})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"本周总时长："}),(0,r.jsx)("span",{className:"font-medium",children:u(s)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"完成任务："}),(0,r.jsxs)("span",{className:"font-medium",children:[a,"项"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"日均时长："}),(0,r.jsx)("span",{className:"font-medium",children:u(Math.round(l))})]})]})]},e.id)})}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"\uD83D\uDCCA 工作平衡度分析"}),(0,r.jsx)("div",{className:"text-sm text-blue-800",children:(()=>{let e=t.members.map(e=>{var t;return(null==(t=n.userStats[e.id])?void 0:t.minutesWorked)||0}),s=Math.max(...e),r=Math.min(...e),a=s>0?1-(s-r)/s:1;return a>=.9?"\uD83C\uDFAF 工作分配非常均衡！继续保持！":a>=.7?"\uD83D\uDC4D 工作分配比较均衡，略有差异。":a>=.5?"⚖️ 工作分配有一定差异，可以适当调整。":"⚠️ 工作分配差异较大，建议重新分配任务。"})()})]})]})}function E(e){let{family:t,tasks:s,dailyStats:l,onClose:n}=e,[i,d]=(0,a.useState)("daily");return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl border-2 border-green-200",children:[(0,r.jsxs)("div",{className:"relative p-6 bg-gradient-to-r from-green-50 to-blue-50 border-b-2 border-green-200",children:[(0,r.jsx)("div",{className:"absolute top-2 left-4 w-8 h-4 bg-white rounded-full opacity-60"}),(0,r.jsx)("div",{className:"absolute top-4 right-6 w-6 h-3 bg-white rounded-full opacity-40"}),(0,r.jsxs)("div",{className:"flex items-center justify-between relative",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center border-2 border-green-300",children:(0,r.jsx)("span",{className:"text-green-700 text-lg",children:"\uD83D\uDCCA"})}),(0,r.jsx)("h2",{className:"text-xl font-bold text-green-800",children:"\uD83C\uDF1F 家务战绩小册子 \uD83C\uDF1F"})]}),(0,r.jsx)("button",{onClick:n,className:"w-8 h-8 bg-white rounded-full flex items-center justify-center text-green-600 hover:text-green-800 hover:bg-green-50 border-2 border-green-300 shadow-sm transition-colors",children:(0,r.jsx)("span",{className:"text-lg",children:"\xd7"})})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>d("daily"),className:"px-6 py-3 text-sm font-medium rounded-xl border-2 transition-all ".concat("daily"===i?"bg-green-100 border-green-300 text-green-800 shadow-md":"bg-white border-green-200 text-green-600 hover:bg-green-50"),children:"\uD83C\uDF31 今日战绩"}),(0,r.jsx)("button",{onClick:()=>d("weekly"),className:"px-6 py-3 text-sm font-medium rounded-xl border-2 transition-all ".concat("weekly"===i?"bg-green-100 border-green-300 text-green-800 shadow-md":"bg-white border-green-200 text-green-600 hover:bg-green-50"),children:"\uD83D\uDCC8 周统计"})]})})]}),(0,r.jsxs)("div",{className:"relative p-6 max-h-[70vh] overflow-y-auto bg-gradient-to-b from-white to-green-25",children:[(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-4 bg-gradient-to-t from-green-100 to-transparent pointer-events-none"}),(0,r.jsx)("div",{className:"relative",children:"daily"===i?(0,r.jsx)(w,{family:t,tasks:s,dailyStats:l}):(0,r.jsx)(C,{family:t,dailyStats:l})})]}),(0,r.jsx)("div",{className:"p-6 bg-gradient-to-r from-green-50 to-blue-50 border-t-2 border-green-200",children:(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(j,{variant:"primary",onClick:n,className:"bg-green-400 hover:bg-green-500 text-white rounded-xl px-8 py-3 border-2 border-green-500 shadow-md font-medium",children:"\uD83C\uDF38 关闭小册子"})})})]})})}function T(e){let{requests:t,family:s,onClose:n}=e,{actions:i}=(0,l.n)(),[d,c]=(0,a.useState)(null),o=t.filter(e=>"pending"===e.status);return 0===o.length?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"✅"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"暂无待处理请求"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"当前没有需要议价的加急任务"}),(0,r.jsx)(j,{variant:"primary",onClick:n,children:"关闭"})]})})}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"加急任务议价"}),(0,r.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("span",{className:"text-2xl",children:"\xd7"})})]}),(0,r.jsxs)("p",{className:"text-gray-600 mt-2",children:["有 ",o.length," 个加急任务等待您的确认"]})]}),(0,r.jsx)("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:(0,r.jsx)("div",{className:"space-y-4",children:o.map(e=>{let a=s.members.find(t=>t.id===e.requestedBy);return(0,r.jsxs)("div",{className:"p-4 border-2 rounded-lg transition-all ".concat(d===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDEA8"}),(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:e.message})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("span",{children:["申请人：",null==a?void 0:a.name]}),(0,r.jsxs)("span",{children:["时间：",m(new Date(e.createdAt))]})]}),e.estimatedMinutes&&(0,r.jsxs)("div",{children:["预估时长：",u(e.estimatedMinutes)]}),e.price&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"外包价："}),(0,r.jsxs)("span",{className:"font-medium text-green-600",children:["\xa5",e.price]})]})]}),(0,r.jsx)("div",{className:"mt-3 p-3 bg-orange-50 border border-orange-200 rounded text-sm text-orange-700",children:"\uD83D\uDCA1 同意后，此金额将加入月度基金，可用于双人奶茶/电影等奖励"})]})}),(0,r.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,r.jsx)(j,{variant:"outline",size:"sm",onClick:()=>{var t;return t=e.id,void i.updateUrgentRequest(t,"rejected")},className:"flex-1",children:"拒绝"}),(0,r.jsxs)(j,{variant:"primary",size:"sm",onClick:()=>(e=>{let r=t.find(t=>t.id===e);r&&(i.updateUrgentRequest(e,"approved"),r.price&&i.updateFamily({monthlyFund:s.monthlyFund+r.price}),i.addTask({title:r.message||"加急任务",description:"议价通过的加急任务，外包价：\xa5".concat(r.price),status:"todo",estimatedMinutes:r.estimatedMinutes||30,category:"加急",isUrgent:!0,urgentPrice:r.price,assignedTo:r.requestedBy}))})(e.id),className:"flex-1",children:["同意（\xa5",e.price,"）"]})]})]},e.id)})})}),(0,r.jsx)("div",{className:"p-6 border-t bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["当前月度基金：\xa5",s.monthlyFund]}),(0,r.jsx)(j,{variant:"outline",onClick:n,children:"稍后处理"})]})})]})})}function S(e){let{availableTasks:t,family:s,currentUserId:n,onClose:d}=e,{actions:c}=(0,l.n)(),[o,x]=(0,a.useState)([]),g=s.members.find(e=>e.id===n),h=t.filter(e=>e.status===i.e.TODO&&e.assignedTo!==n);return 0===h.length?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsx)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDE0A"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"暂无可抢单任务"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"当前没有可以抢单的任务，或者所有任务都已分配给您"}),(0,r.jsx)(j,{variant:"primary",onClick:d,children:"关闭"})]})})}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,r.jsx)("div",{className:"p-6 border-b",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"任务抢单"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[null==g?void 0:g.name,"，选择您想要承接的任务"]})]}),(0,r.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("span",{className:"text-2xl",children:"\xd7"})})]})}),(0,r.jsx)("div",{className:"p-6 bg-blue-50 border-b",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCAA"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-1",children:"抢单规则"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsx)("li",{children:"• 可以抢取其他成员的待办任务"}),(0,r.jsx)("li",{children:"• 抢单后任务将重新分配给您"}),(0,r.jsx)("li",{children:"• 建议根据个人时间和能力合理抢单"})]})]})]})}),(0,r.jsx)("div",{className:"p-6 max-h-[50vh] overflow-y-auto",children:(0,r.jsx)("div",{className:"space-y-3",children:h.map(e=>{let t=s.members.find(t=>t.id===e.assignedTo),a=o.includes(e.id);return(0,r.jsx)("div",{onClick:()=>{var t;return t=e.id,void x(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"p-4 border-2 rounded-lg cursor-pointer transition-all ".concat(a?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,r.jsx)("div",{className:"mt-1",children:a?(0,r.jsx)("span",{className:"text-blue-500 text-lg",children:"✓"}):(0,r.jsx)("span",{className:"text-gray-300 text-lg",children:"○"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:e.title}),e.isUrgent&&(0,r.jsx)("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded-full",children:"加急"})]}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,r.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["分类：",e.category]}),e.estimatedMinutes&&(0,r.jsxs)("span",{children:["预估：",u(e.estimatedMinutes)]}),(0,r.jsxs)("span",{children:["创建：",m(new Date(e.createdAt))]})]}),t&&(0,r.jsxs)("div",{className:"mt-2 text-sm text-orange-600",children:["当前分配给：",t.name]})]})]})})},e.id)})})}),o.length>0&&(0,r.jsx)("div",{className:"p-4 bg-green-50 border-t border-b",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-green-800",children:["已选择 ",o.length," 个任务"]}),(0,r.jsxs)("div",{className:"text-sm font-medium text-green-900",children:["预估总时长：",u(o.reduce((e,t)=>{let s=h.find(e=>e.id===t);return e+((null==s?void 0:s.estimatedMinutes)||0)},0))]})]})}),(0,r.jsx)("div",{className:"p-6 border-t bg-gray-50",children:(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)(j,{variant:"outline",onClick:d,children:"取消"}),(0,r.jsxs)(j,{variant:"primary",onClick:()=>{if(0===o.length)return void alert("请选择要抢单的任务");o.forEach(e=>{c.updateTask(e,{assignedTo:n})}),alert("成功抢单 ".concat(o.length," 个任务！")),d()},disabled:0===o.length,children:["抢单 (",o.length,")"]})]})})]})})}function M(){let[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{i(/iPad|iPhone|iPod/.test(navigator.userAgent)),c(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"));let e=e=>{e.preventDefault(),t(e),setTimeout(()=>{l(!0)},3e3)},s=()=>{console.log("[PWA] App was installed"),l(!1),t(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",s),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",s)}},[]);let o=async()=>{if(e)try{await e.prompt();let{outcome:s}=await e.userChoice;console.log("[PWA] User response to install prompt: ".concat(s)),t(null),l(!1)}catch(e){console.error("[PWA] Install prompt failed:",e)}},m=()=>{l(!1),localStorage.setItem("pwa-install-dismissed",Date.now().toString())};return((0,a.useEffect)(()=>{let e=localStorage.getItem("pwa-install-dismissed");if(e){let t=parseInt(e);if((Date.now()-t)/36e5<24)return void l(!1)}},[]),d)?null:n&&s?(0,r.jsx)("div",{className:"fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCF1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-bold mb-2",children:"安装家庭助手到主屏幕"}),(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsx)("p",{children:"1. 点击浏览器底部的分享按钮 \uD83D\uDCE4"}),(0,r.jsx)("p",{children:'2. 选择"添加到主屏幕"'}),(0,r.jsx)("p",{children:'3. 点击"添加"完成安装'})]})]}),(0,r.jsx)("button",{onClick:m,className:"text-white hover:text-gray-200",children:"✕"})]})}):e&&s?(0,r.jsx)("div",{className:"fixed bottom-4 left-4 right-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-lg shadow-lg z-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"text-2xl",children:"\uD83C\uDFE0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold",children:"安装家庭助手"}),(0,r.jsx)("p",{className:"text-sm text-blue-100",children:"安装到设备，获得更好的使用体验"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(j,{variant:"outline",size:"sm",onClick:m,className:"text-white border-white hover:bg-white hover:text-blue-600",children:"稍后"}),(0,r.jsx)(j,{variant:"primary",size:"sm",onClick:o,className:"bg-white text-blue-600 hover:bg-gray-100",children:"安装"})]})]})}):null}function O(){return(0,a.useEffect)(()=>{let e=()=>{let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),null}function A(){return(0,a.useEffect)(()=>{let e=()=>{window.innerHeight<.75*window.screen.height?document.body.classList.add("keyboard-open"):document.body.classList.remove("keyboard-open")};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),null}function P(){return(0,a.useEffect)(()=>{if("performance"in window){let e=new PerformanceObserver(e=>{for(let t of e.getEntries())"navigation"===t.entryType&&console.log("[Performance] Page load time:",t.duration),"paint"===t.entryType&&console.log("[Performance] ".concat(t.name,":"),t.startTime)});return e.observe({entryTypes:["navigation","paint"]}),()=>e.disconnect()}},[]),null}function R(){let[e,t]=(0,a.useState)(!0),[s,l]=(0,a.useState)("");return((0,a.useEffect)(()=>{let e=()=>{t(navigator.onLine)},s=()=>{let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e&&l(e.effectiveType||e.type||"unknown")};e(),s(),window.addEventListener("online",e),window.addEventListener("offline",e);let r=navigator.connection;return r&&r.addEventListener("change",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e),r&&r.removeEventListener("change",s)}},[]),e)?"slow-2g"===s||"2g"===s?(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 bg-orange-500 text-white text-center py-2 text-sm z-50",children:"\uD83D\uDC0C 网络连接较慢，部分功能可能受影响"}):null:(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 bg-red-500 text-white text-center py-2 text-sm z-50",children:"\uD83D\uDCE1 网络连接已断开，正在离线模式下运行"})}D.t1.register(D.PP,D.kc,D.E8,D.hE,D.m_,D.s$);var L=s(6747);function I(e){let{onRoomJoined:t}=e,[s]=(0,a.useState)(()=>L.d.getInstance()),[l,n]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[c,o]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[h,b]=(0,a.useState)(""),[p,j]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[N,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=s.getCurrentRoomId();e&&(n(e),w(e))},[s]);let w=e=>{d(s.getRoomInfo(e)),o(s.getRoomMembers())};return l&&i?(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:i.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["房间ID: ",l]})]}),(0,r.jsx)("button",{onClick:()=>{let e=s.getRoomShareLink();navigator.clipboard.writeText(e).then(()=>{alert("分享链接已复制到剪贴板！"),y(!1)}).catch(()=>{y(!0)})},className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"分享房间"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,r.jsxs)("span",{children:["\uD83D\uDC65 ",c.length," 位成员"]}),(0,r.jsxs)("span",{children:["\uD83D\uDD52 创建于 ",new Date(i.createdAt).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),c.length>0&&(0,r.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:c.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-100 rounded-full text-sm",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(e.isOnline?"bg-green-500":"bg-gray-400")}),(0,r.jsx)("span",{children:e.name})]},e.id))}),N&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"分享房间"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"复制下面的链接分享给其他家庭成员："}),(0,r.jsx)("div",{className:"bg-gray-100 p-3 rounded-lg mb-4 break-all text-sm",children:s.getRoomShareLink()}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(s.getRoomShareLink()),alert("已复制到剪贴板！"),y(!1)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"复制链接"}),(0,r.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"关闭"})]})]})})]}):(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-4",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"欢迎使用家庭助手"}),(0,r.jsx)("p",{className:"text-gray-600",children:"创建新的家庭房间或加入现有房间开始协作"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsx)("button",{onClick:()=>x(!0),className:"p-4 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl mb-2",children:"\uD83C\uDFE0"}),(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:"创建新房间"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"建立一个新的家庭协作空间"})]})}),(0,r.jsx)("button",{onClick:()=>g(!0),className:"p-4 border-2 border-dashed border-green-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl mb-2",children:"\uD83D\uDEAA"}),(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:"加入房间"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"使用房间ID加入现有家庭"})]})})]}),m&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"创建新房间"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"房间名称"}),(0,r.jsx)("input",{type:"text",value:h,onChange:e=>b(e.target.value),placeholder:"例如：我们的家",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"您的昵称"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>v(e.target.value),placeholder:"例如：小明",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,r.jsx)("button",{onClick:()=>{if(!h.trim()||!f.trim())return;let e=s.createRoom(h.trim());s.addMemberToRoom(f.trim()),n(e),w(e),x(!1),b(""),v(""),t(e)},disabled:!h.trim()||!f.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"创建房间"}),(0,r.jsx)("button",{onClick:()=>{x(!1),b(""),v("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"取消"})]})]})}),u&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"加入房间"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"房间ID"}),(0,r.jsx)("input",{type:"text",value:p,onChange:e=>j(e.target.value.toUpperCase()),placeholder:"例如：ABC12345",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"您的昵称"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>v(e.target.value),placeholder:"例如：小红",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,r.jsx)("button",{onClick:()=>{p.trim()&&f.trim()&&(s.joinRoom(p.trim().toUpperCase())?(s.addMemberToRoom(f.trim()),n(p.trim().toUpperCase()),w(p.trim().toUpperCase()),g(!1),j(""),v(""),t(p.trim().toUpperCase())):alert("房间不存在或已过期"))},disabled:!p.trim()||!f.trim(),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"加入房间"}),(0,r.jsx)("button",{onClick:()=>{g(!1),j(""),v("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"取消"})]})]})})]})}function z(){let{state:e,actions:t}=(0,l.n)(),{data:s,isLoading:n,isInRoom:i}=e,[d,c]=(0,a.useState)(!1),[o,m]=(0,a.useState)(!1),[x,u]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if(!s)return;let e=()=>{let e=new Date,[t,r]=s.family.workEndTime.split(":").map(Number),a=new Date;a.setHours(t,r,0,0),e>=a&&!x&&u(!0)},t=setInterval(e,6e4);return e(),()=>clearInterval(t)},[s,x]),(0,a.useEffect)(()=>{s&&s.urgentRequests.filter(e=>"pending"===e.status).length>0&&!g&&setTimeout(()=>{h(!0)},1e3)},[s,g]),n)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})}):s?(0,r.jsxs)("div",{className:"min-h-screen-safe bg-gray-50",children:[(0,r.jsx)(O,{}),(0,r.jsx)(A,{}),(0,r.jsx)(P,{}),(0,r.jsx)(R,{}),!i&&(0,r.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,r.jsx)(I,{onRoomJoined:e=>{window.location.reload()}})}),i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f,{family:s.family,onShowStats:()=>m(!0),onShowTaskCreator:()=>c(!0),onShowTaskGrab:()=>j(!0)}),(0,r.jsx)("main",{className:"container mx-auto px-4 py-6",children:(0,r.jsx)(p,{tasks:s.tasks,family:s.family})})]}),d&&(0,r.jsx)(y,{family:s.family,onClose:()=>c(!1)}),o&&(0,r.jsx)(E,{family:s.family,tasks:s.tasks,dailyStats:s.dailyStats,onClose:()=>m(!1)}),x&&(0,r.jsx)(v,{workEndTime:s.family.workEndTime,onClose:()=>u(!1),onContinue:()=>{u(!1),c(!0)}}),g&&(0,r.jsx)(T,{requests:s.urgentRequests,family:s.family,onClose:()=>h(!1)}),b&&(0,r.jsx)(S,{availableTasks:s.tasks,family:s.family,currentUserId:s.family.members[0].id,onClose:()=>j(!1)}),(0,r.jsx)(M,{})]}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{className:"text-red-600",children:"数据加载失败，请刷新页面重试"})})})}}},e=>{e.O(0,[647,303,273,441,255,358],()=>e(e.s=247)),_N_E=e.O()}]);